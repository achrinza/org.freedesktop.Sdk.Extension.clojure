# SPDX-License-Identifier: FSFAP
id: org.freedesktop.Sdk.Extension.clojure
name: Clojure
branch: "24.08"
runtime: org.freedesktop.Sdk
runtime-version: "24.08"
sdk: org.freedesktop.Sdk
build-extension: true
separate-locales: false
appstream-compose: false
modules:
  - name: clojure
    buildsystem: simple
    build-options:
      env:
        bin_dir: "/usr/lib/sdk/clojure/bin"
        lib_dir: "/usr/lib/sdk/clojure/lib"
        clojure_lib_dir: "/usr/lib/sdk/clojure/lib/clojure"
    sources:
      - type: archive
        url: https://github.com/clojure/brew-install/releases/download/1.12.0.1479/clojure-tools-1.12.0.1479.tar.gz
        sha256: "2a515c45755df1edf378fdfafb380251c7736de2db15f7dbe55ed7295f0d296c"
    build-commands:
      - install -Dm644 deps.edn "$clojure_lib_dir/deps.edn"
      - install -Dm644 example-deps.edn "$clojure_lib_dir/example-deps.edn"
      - install -Dm644 tools.edn "$clojure_lib_dir/tools.edn"
      - install -Dm644 exec.jar "$clojure_lib_dir/libexec/exec.jar"
      - install -Dm644 clojure-tools-1.12.0.1479.jar "$clojure_lib_dir/libexec/clojure-tools-1.20.0.1479.jar"
      - sed -i -e 's@PREFIX@'"$clojure_lib_dir"'@g' clojure
      - sed -i -e 's@BINDIR@'"$bin_dir"'@g' clj
      - install -Dm755 clojure "$bin_dir/clojure"
      - install -Dm755 clj "$bin_dir/clj"
  - name: scripts
    build-options:
      env:
        bin_dir: "/usr/lib/sdk/clojure/bin"
    buildsystem: simple
    sources:
      - type: script
        commands:
          - export PATH=$PATH:BINDIR
        dest-filename: enable.sh
    build-commands:
      - sed -i -e 's@BINDIR@'"$bin_dir"'@g' enable.sh
      - install -Dm755 enable.sh "$FLATPAK_DEST"
  - name: metainfo
    buildsystem: simple
    sources:
      - type: file
        path: org.freedesktop.Sdk.Extension.clojure.metainfo.xml
    build-commands:
      - install -Dm644 org.freedesktop.Sdk.Extension.clojure.metainfo.xml ${FLATPAK_DEST}/share/metainfo
